<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 3 Data Tidying | Intro to Data Wrangling and Analysis Using R</title>
<meta name="author" content="Emily Nordmann &amp; Javan Carter">
<meta name="description" content="3.1 Intended Learning Outcomes By the end of this chapter you should be able to: Reshape data between long and wide formats Use pipes to chain together functions  3.2 Walkthrough video We...">
<meta name="generator" content="bookdown 0.25 with bs4_book()">
<meta property="og:title" content="Chapter 3 Data Tidying | Intro to Data Wrangling and Analysis Using R">
<meta property="og:type" content="book">
<meta property="og:url" content="https://emilynordmann.github.io/AllOfUs-data-analysis/tidy.html">
<meta property="og:image" content="https://emilynordmann.github.io/AllOfUs-data-analysis/images/logos/logo.png">
<meta property="og:description" content="3.1 Intended Learning Outcomes By the end of this chapter you should be able to: Reshape data between long and wide formats Use pipes to chain together functions  3.2 Walkthrough video We...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Chapter 3 Data Tidying | Intro to Data Wrangling and Analysis Using R">
<meta name="twitter:description" content="3.1 Intended Learning Outcomes By the end of this chapter you should be able to: Reshape data between long and wide formats Use pipes to chain together functions  3.2 Walkthrough video We...">
<meta name="twitter:image" content="https://emilynordmann.github.io/AllOfUs-data-analysis/images/logos/logo.png">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.3.1/transition.js"></script><script src="libs/bs3compat-0.3.1/tabs.js"></script><script src="libs/bs3compat-0.3.1/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/kePrint-0.0.1/kePrint.js"></script><link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
<style type="text/css">
    /* Used with Pandoc 2.11+ new --citeproc when CSL is used */
    div.csl-bib-body { }
    div.csl-entry {
      clear: both;
        }
    .hanging div.csl-entry {
      margin-left:2em;
      text-indent:-2em;
    }
    div.csl-left-margin {
      min-width:2em;
      float:left;
    }
    div.csl-right-inline {
      margin-left:2em;
      padding-left:1em;
    }
    div.csl-indent {
      margin-left: 2em;
    }
  </style>
<link rel="stylesheet" href="include/psyteachr.css">
<link rel="stylesheet" href="include/webex.css">
<link rel="stylesheet" href="include/style.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Intro to Data Wrangling and Analysis Using R</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Introduction</a></li>
<li><a class="" href="prerequisites.html"><span class="header-section-number">1</span> Pre-requisites</a></li>
<li><a class="" href="wrangle.html"><span class="header-section-number">2</span> Data Wrangling</a></li>
<li><a class="active" href="tidy.html"><span class="header-section-number">3</span> Data Tidying</a></li>
<li><a class="" href="live-office-hour-1.html"><span class="header-section-number">4</span> Live Office Hour 1</a></li>
<li><a class="" href="analysis1.html"><span class="header-section-number">5</span> Comparing Means</a></li>
<li><a class="" href="analysis2.html"><span class="header-section-number">6</span> Correlation and Regression</a></li>
<li><a class="" href="live-office-hour-2.html"><span class="header-section-number">7</span> Live Office Hour 2</a></li>
<li><a class="" href="completion-quiz.html"><span class="header-section-number">8</span> Completion Quiz</a></li>
<li class="book-part">Appendices</li>
<li><a class="" href="glossary.html"><span class="header-section-number">A</span> Glossary</a></li>
<li><a class="" href="license.html">License</a></li>
<li><a class="" href="references.html">References</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/psyteachr/template">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="tidy" class="section level1" number="3">
<h1>
<span class="header-section-number">3</span> Data Tidying<a class="anchor" aria-label="anchor" href="#tidy"><i class="fas fa-link"></i></a>
</h1>
<div id="ilo-tidy" class="section level2" number="3.1">
<h2>
<span class="header-section-number">3.1</span> Intended Learning Outcomes<a class="anchor" aria-label="anchor" href="#ilo-tidy"><i class="fas fa-link"></i></a>
</h2>
<p>By the end of this chapter you should be able to:</p>
<ul>
<li>Reshape data between long and wide formats</li>
<li>Use pipes to chain together functions</li>
</ul>
</div>
<div id="walkthrough-tidy" class="section level2" number="3.2">
<h2>
<span class="header-section-number">3.2</span> Walkthrough video<a class="anchor" aria-label="anchor" href="#walkthrough-tidy"><i class="fas fa-link"></i></a>
</h2>
<p>We encourage you to read the workbook and attempt each step on your own before watching the video as this will help consolidate your learning (it may feel harder but making mistakes is informative and will help you learn more in the long-run).</p>
<iframe width="560" height="315" src="https://www.youtube.com/embed/EdyzbHWMl-o" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen>
</iframe>
</div>
<div id="setup-tidy" class="section level2" number="3.3">
<h2>
<span class="header-section-number">3.3</span> Set-up<a class="anchor" aria-label="anchor" href="#setup-tidy"><i class="fas fa-link"></i></a>
</h2>
<ul>
<li>Create and save a new R Markdown document named <code>chapter_3.Rmd</code>, get rid of the default template text from line 11 onwards.</li>
<li>Add the below code to the set-up chunk and then run the code to load the packages and data.You may need to install the packages if you don't have them installed already.</li>
</ul>
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span> 
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://higgi13425.github.io/medicaldata/">medicaldata</a></span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"polyps"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"theoph"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"laryngoscope"</span><span class="op">)</span></code></pre></div>
<p>Download the <a href="https://raw.githubusercontent.com/rstudio/cheatsheets/main/tidyr.pdf">Data tidying cheat sheet</a>.</p>
</div>
<div id="data-structures" class="section level2" number="3.4">
<h2>
<span class="header-section-number">3.4</span> Data Structures<a class="anchor" aria-label="anchor" href="#data-structures"><i class="fas fa-link"></i></a>
</h2>
<p>The data you work with will likely come in many different formats and structures. Some of these structures may be driven by how the software you use outputs the data, but data structures may also differ because of human intervention or attempts at organisation, some of which may not be particularly helpful.</p>
<p>Data cleaning and tidying will likely be the most time consuming and difficult task you perform. Whilst you can create code recipes for analyses and visualisations, as Hadley Whickham puts it, <a href="https://vita.had.co.nz/papers/tidy-data.pdf">"every messy dataset is messy in its own way"</a>, which means that you will often have to solve new problems that are specific to the dataset. Additionally, moving between data structures that are intuitive to read by humans and those that are useful for a computer requires a conceptual shift that only comes with practice.</p>
<p>This is all a verbose way of saying that what lies ahead in this chapter is unlikely to sink in on the first attempt and you will need to practice with different examples (preferably with data you know well) before you truly feel comfortable with it.</p>
<p>First, some terminology.</p>
<p>An <a class="glossary" target="_blank" title="All of the data about a single trial or question." href="https://psyteachr.github.io/glossary/o#observation">observation</a> is all the information about a single "thing" in a single condition, such as at one point in time. These things can be patients, sales, participants, feedback questionnaires, or really anything. Observations should have a way to identify them, such as a unique ID or a unique combination of values like ID and time-point</p>
<p>A <a class="glossary" target="_blank" title="(coding): A word that identifies and stores the value of some data for later use; (stats): An attribute or characteristic of an observation that you can measure, count, or describe" href="https://psyteachr.github.io/glossary/v#variable">variable</a> is one type of information about the observation. For example, if observation is a participant, the variables you might have about the participant are the participant ID, the participant's sex and age, which condition of the experiment they were in, and their score.</p>
<p>A <a class="glossary" target="_blank" title="A single number or piece of data." href="https://psyteachr.github.io/glossary/v#value">value</a> is the data for one variable for one observation. For example, the value of the age variable from the observation of a participant might be <code>23</code>.</p>
<div class="try">
<p>The dataset <code>theoph</code> that you loaded in during set-up is from a study looking at anti-asthma medication. There are 12 participants who were given a dose of the medication and whose plasma was tested at 11 different time points (you can read the full details by running the help documentation <code><a href="https://higgi13425.github.io/medicaldata/reference/theoph.html">?theoph</a></code>). Have a look at this dataset and then answer the following questions:</p>
<ul>
<li>What is <code>Time</code>? <select class="webex-select"><option value="blank"></option>
<option value="x">Observation</option>
<option value="answer">Variable</option>
<option value="x">Value</option></select>
</li>
<li>How many observations are there in this dataset? <input class="webex-solveme nospaces" size="3" data-answer='["132"]'>
</li>
<li>What is <code>79.6</code>? <select class="webex-select"><option value="blank"></option>
<option value="x">Observation</option>
<option value="x">Variable</option>
<option value="answer">Value</option></select>
</li>
</ul>
<div class="webex-solution">
<button>
Explain these answers
</button>
<ul>
<li>
<code>Time</code> is a type of information in the dataset. There are five variables, <code>Subject</code>, <code>Wt</code>, <code>Dose</code>, <code>Time</code> and <code>conc</code>.</li>
<li>There are 132 observations, 11 for each of 12 participants for each of the different time points.</li>
<li>
<code>79.6</code> is a value because it is a single data point for one variable for one observation.</li>
</ul>
</div>
</div>
</div>
<div id="reshaping-data" class="section level2" number="3.5">
<h2>
<span class="header-section-number">3.5</span> Reshaping Data<a class="anchor" aria-label="anchor" href="#reshaping-data"><i class="fas fa-link"></i></a>
</h2>
<p>Data tables can be in <a class="glossary" target="_blank" title="A data format where all of the observations about one subject are in the same row" href="https://psyteachr.github.io/glossary/w#wide">wide</a> format or <a class="glossary" target="_blank" title="A data format where each observation is on a separate row" href="https://psyteachr.github.io/glossary/l#long">long</a> format (or a mix of the two). Wide data are where all the observations about one thing are in the same row, while long data are where each observation is on a separate row. You often need to convert between these formats to do different types of summaries or visualisation. You may have done something similar using pivot tables in Excel.</p>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:img-pivot-table"></span>
<img src="images/tidy/excel_pivot_table.png" alt="Converting between wide and long formats using pivot tables in Excel." width="100%"><p class="caption">
Figure 3.1: Converting between wide and long formats using pivot tables in Excel.
</p>
</div>
<div id="wide-format-data" class="section level3" number="3.5.1">
<h3>
<span class="header-section-number">3.5.1</span> Wide-format data<a class="anchor" aria-label="anchor" href="#wide-format-data"><i class="fas fa-link"></i></a>
</h3>
<p>The <code>polyps</code> dataset we've used in the previous chapter is an example of a wide-form dataset. All the observations about each participant are in the same row. Each participant has data from three time-points (<code>baseline</code>, <code>number3m</code>, <code>number12m</code>) which are stored in three separate columns</p>
<div class="kable-table">
<div class="inline-table"><table class="table table-sm">
<thead><tr>
<th style="text-align:left;">
participant_id
</th>
<th style="text-align:left;">
sex
</th>
<th style="text-align:right;">
age
</th>
<th style="text-align:right;">
baseline
</th>
<th style="text-align:left;">
treatment
</th>
<th style="text-align:right;">
number3m
</th>
<th style="text-align:right;">
number12m
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
001
</td>
<td style="text-align:left;">
female
</td>
<td style="text-align:right;">
17
</td>
<td style="text-align:right;">
7
</td>
<td style="text-align:left;">
sulindac
</td>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:left;">
002
</td>
<td style="text-align:left;">
female
</td>
<td style="text-align:right;">
20
</td>
<td style="text-align:right;">
77
</td>
<td style="text-align:left;">
placebo
</td>
<td style="text-align:right;">
67
</td>
<td style="text-align:right;">
63
</td>
</tr>
<tr>
<td style="text-align:left;">
003
</td>
<td style="text-align:left;">
male
</td>
<td style="text-align:right;">
16
</td>
<td style="text-align:right;">
7
</td>
<td style="text-align:left;">
sulindac
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
2
</td>
</tr>
<tr>
<td style="text-align:left;">
004
</td>
<td style="text-align:left;">
female
</td>
<td style="text-align:right;">
18
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:left;">
placebo
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
28
</td>
</tr>
<tr>
<td style="text-align:left;">
005
</td>
<td style="text-align:left;">
male
</td>
<td style="text-align:right;">
22
</td>
<td style="text-align:right;">
23
</td>
<td style="text-align:left;">
sulindac
</td>
<td style="text-align:right;">
16
</td>
<td style="text-align:right;">
17
</td>
</tr>
<tr>
<td style="text-align:left;">
006
</td>
<td style="text-align:left;">
female
</td>
<td style="text-align:right;">
13
</td>
<td style="text-align:right;">
35
</td>
<td style="text-align:left;">
placebo
</td>
<td style="text-align:right;">
31
</td>
<td style="text-align:right;">
61
</td>
</tr>
</tbody>
</table></div>
</div>
<div class="try">
<p>Whilst wide-form data is easy to read, it sometimes obfuscates how many variables you actually have in the dataset because the observations are spread over columns. Have a look at the <code>polyps</code> dataset and think about how many variables there are thinking about variables as a type of information, rather than as a column:</p>
<ul>
<li>How many variables (types of information) are there in the <code>polyps</code> dataset? <input class="webex-solveme nospaces" size="1" data-answer='["6"]'>
</li>
</ul>
<div class="webex-solution">
<button>
Explain this answer
</button>
<p>There are six variables. Four of them are relatively straightforward: <code>participant_id</code>, <code>sex</code>, <code>age</code>, and <code>treatment</code>. The final two are where it gets more complicated. The three columns <code>baseline</code>, <code>number3m</code>, and <code>number12m</code> actually represent two bits of information, the number of polyps (let's call this <code>polyps_n</code>), at each time-point (<code>timepoint</code>).</p>
</div>
</div>
</div>
<div id="tidy-data" class="section level3" number="3.5.2">
<h3>
<span class="header-section-number">3.5.2</span> Tidy data<a class="anchor" aria-label="anchor" href="#tidy-data"><i class="fas fa-link"></i></a>
</h3>
<p>Whilst wide-form data is intuitive for humans to read and enter data into, it can also be a little difficult to work with in R. Instead, we often need to use "<a class="glossary" target="_blank" title="A format for data that maps the meaning onto the structure." href="https://psyteachr.github.io/glossary/t#tidy-data">tidy data</a> in long-form <a class="footnote-ref" tabindex="0" data-toggle="popover" data-content="&lt;p&gt;Just because a table is long doesn't mean it is tidy (see examples &lt;a href=&quot;https://kiwidamien.github.io/what-is-tidy-data.html&quot;&gt;here&lt;/a&gt;) but they're often used synonymously which we're going to adopt for the purposes of this chapter.&lt;/p&gt;"><sup>1</sup></a>, which is data in a format that makes it easier to combine data from different tables, create summary tables, and visualise your data.</p>
<ul>
<li>Each observation must have its own row</li>
<li>Each variable must have its own column</li>
<li>Each value must have its own cell</li>
</ul>
<p>We've already seen an example of tidy data - the <code>theoph</code> dataset and the easy way to spot this is that there are multiple rows of data for the same <code>Subject</code> rather than all observations being spread out across columns in a single row:</p>
<div class="kable-table">
<div class="inline-table"><table class="table table-sm">
<thead><tr>
<th style="text-align:left;">
Subject
</th>
<th style="text-align:right;">
Wt
</th>
<th style="text-align:right;">
Dose
</th>
<th style="text-align:right;">
Time
</th>
<th style="text-align:right;">
conc
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
1
</td>
<td style="text-align:right;">
79.6
</td>
<td style="text-align:right;">
4.02
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;">
0.74
</td>
</tr>
<tr>
<td style="text-align:left;">
1
</td>
<td style="text-align:right;">
79.6
</td>
<td style="text-align:right;">
4.02
</td>
<td style="text-align:right;">
0.25
</td>
<td style="text-align:right;">
2.84
</td>
</tr>
<tr>
<td style="text-align:left;">
1
</td>
<td style="text-align:right;">
79.6
</td>
<td style="text-align:right;">
4.02
</td>
<td style="text-align:right;">
0.57
</td>
<td style="text-align:right;">
6.57
</td>
</tr>
<tr>
<td style="text-align:left;">
1
</td>
<td style="text-align:right;">
79.6
</td>
<td style="text-align:right;">
4.02
</td>
<td style="text-align:right;">
1.12
</td>
<td style="text-align:right;">
10.50
</td>
</tr>
<tr>
<td style="text-align:left;">
1
</td>
<td style="text-align:right;">
79.6
</td>
<td style="text-align:right;">
4.02
</td>
<td style="text-align:right;">
2.02
</td>
<td style="text-align:right;">
9.66
</td>
</tr>
<tr>
<td style="text-align:left;">
1
</td>
<td style="text-align:right;">
79.6
</td>
<td style="text-align:right;">
4.02
</td>
<td style="text-align:right;">
3.82
</td>
<td style="text-align:right;">
8.58
</td>
</tr>
</tbody>
</table></div>
</div>
<p>The tidy version of the <code>polyps</code> dataset would look like this:</p>
<div class="kable-table">
<div class="inline-table"><table class="table table-sm">
<thead><tr>
<th style="text-align:left;">
participant_id
</th>
<th style="text-align:left;">
sex
</th>
<th style="text-align:right;">
age
</th>
<th style="text-align:left;">
treatment
</th>
<th style="text-align:left;">
time
</th>
<th style="text-align:right;">
polyps_n
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
001
</td>
<td style="text-align:left;">
female
</td>
<td style="text-align:right;">
17
</td>
<td style="text-align:left;">
sulindac
</td>
<td style="text-align:left;">
baseline
</td>
<td style="text-align:right;">
7
</td>
</tr>
<tr>
<td style="text-align:left;">
001
</td>
<td style="text-align:left;">
female
</td>
<td style="text-align:right;">
17
</td>
<td style="text-align:left;">
sulindac
</td>
<td style="text-align:left;">
number3m
</td>
<td style="text-align:right;">
6
</td>
</tr>
<tr>
<td style="text-align:left;">
001
</td>
<td style="text-align:left;">
female
</td>
<td style="text-align:right;">
17
</td>
<td style="text-align:left;">
sulindac
</td>
<td style="text-align:left;">
number12m
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:left;">
002
</td>
<td style="text-align:left;">
female
</td>
<td style="text-align:right;">
20
</td>
<td style="text-align:left;">
placebo
</td>
<td style="text-align:left;">
baseline
</td>
<td style="text-align:right;">
77
</td>
</tr>
<tr>
<td style="text-align:left;">
002
</td>
<td style="text-align:left;">
female
</td>
<td style="text-align:right;">
20
</td>
<td style="text-align:left;">
placebo
</td>
<td style="text-align:left;">
number3m
</td>
<td style="text-align:right;">
67
</td>
</tr>
<tr>
<td style="text-align:left;">
002
</td>
<td style="text-align:left;">
female
</td>
<td style="text-align:right;">
20
</td>
<td style="text-align:left;">
placebo
</td>
<td style="text-align:left;">
number12m
</td>
<td style="text-align:right;">
63
</td>
</tr>
</tbody>
</table></div>
</div>
<ul>
<li>There are now six variables (columns) because there are six different types of information we have for each observation: the participant id, sex, age, treatment condition, time point of the measurement, and the measurement itself (number of polyps).</li>
<li>Each row is a participant's polyp measurement at a particular time-point.</li>
</ul>
<p>The pivot functions allow you to transform a data table from wide to long or long to wide.</p>
</div>
<div id="wide-to-long" class="section level3" number="3.5.3">
<h3>
<span class="header-section-number">3.5.3</span> Wide to long<a class="anchor" aria-label="anchor" href="#wide-to-long"><i class="fas fa-link"></i></a>
</h3>
<p>The function <code><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer()</a></code> converts a wide data table to a longer format by converting the headers from specified columns into the values of new columns, and combining the values of those columns into a new condensed column.</p>
<p>This function has several arguments:</p>
<ul>
<li>
<code>cols</code>: the columns you want to make long; you can refer to them by their names, like <code>c("baseline", "number3m", "number12m")</code> or by their numbers, like <code>c(4, 6, 7)</code>
</li>
<li>
<code>names_to</code>: what you want to call the new columns that the <code>cols</code> column header names will go into</li>
<li>
<code>values_to</code>: what you want to call the new column that contains the values in the <code>cols</code>
</li>
</ul>
<p>With the pivot functions, it can be easier to show than tell - run the below code and then compare <code>polyps</code> with <code>polyps_tidy</code> and the pivot code and try to map each argument to what has changed.</p>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">polyps_tidy</span> <span class="op">&lt;-</span> <span class="va">polyps</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"baseline"</span>, <span class="st">"number3m"</span>, <span class="st">"number12m"</span><span class="op">)</span>, <span class="co"># columns to make long </span>
               names_to <span class="op">=</span> <span class="st">"time"</span>, <span class="co"># new column name for headers</span>
               values_to <span class="op">=</span> <span class="st">"polyps_n"</span><span class="op">)</span> <span class="co"># new column name for values</span></code></pre></div>
<p>The long-form dataset makes it possible to use tidyverse functions to flexibly summarize and visualise our dataset. For example, with the wide-form dataset, in order to calculate the mean number of polyps at each time-point, we would need to specify the calculation for each time-point individually:</p>
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">polyps</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span>mean_baseline <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">baseline</span><span class="op">)</span>,
            mean_3m <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">number3m</span><span class="op">)</span>,
            mean_12m <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">number12m</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="kable-table">
<div class="inline-table"><table class="table table-sm">
<thead><tr>
<th style="text-align:right;">
mean_baseline
</th>
<th style="text-align:right;">
mean_3m
</th>
<th style="text-align:right;">
mean_12m
</th>
</tr></thead>
<tbody><tr>
<td style="text-align:right;">
40.95455
</td>
<td style="text-align:right;">
38.40909
</td>
<td style="text-align:right;">
24.05
</td>
</tr></tbody>
</table></div>
</div>
<p>However, with the tidy version, not only does the code become more concise (and therefore less error-prone) but it also means that if additional time-points were added to the same dataset, the code doesn't need to change: it will return the calculation of all groups.</p>
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">polyps_tidy</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">time</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span>mean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">polyps_n</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="kable-table">
<div class="inline-table"><table class="table table-sm">
<thead><tr>
<th style="text-align:left;">
time
</th>
<th style="text-align:right;">
mean
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
baseline
</td>
<td style="text-align:right;">
40.95455
</td>
</tr>
<tr>
<td style="text-align:left;">
number12m
</td>
<td style="text-align:right;">
24.05000
</td>
</tr>
<tr>
<td style="text-align:left;">
number3m
</td>
<td style="text-align:right;">
38.40909
</td>
</tr>
</tbody>
</table></div>
</div>
<p>An added benefit is that tidy datasets work very well with <code class="package">ggplot</code> (the below plot would be quite tricky to create with the wide-form dataset):</p>
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">polyps_tidy</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">polyps_n</span>, fill <span class="op">=</span> <span class="va">time</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram</a></span><span class="op">(</span>show.legend <span class="op">=</span> <span class="cn">F</span>, colour <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">time</span>, nrow <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html">scale_fill_viridis_d</a></span><span class="op">(</span>option <span class="op">=</span> <span class="st">"E"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="03-tidying_files/figure-html/unnamed-chunk-5-1.png" width="100%" style="display: block; margin: auto;"></div>
<div class="info">
<p>For those of you who are experimental researchers, you may find it easier to remember that each IV and DV should have its own column, rather than a column for each level of the IV.</p>
</div>
</div>
<div id="long-to-wide" class="section level3" number="3.5.4">
<h3>
<span class="header-section-number">3.5.4</span> Long to wide<a class="anchor" aria-label="anchor" href="#long-to-wide"><i class="fas fa-link"></i></a>
</h3>
<p>Whilst long-form data is practically essential for working in R (particularly if you rely heavily on the tidyverse), there are times when you need a wide-form dataset. If your original dataset was in long-form, we can also go from long to wide format using the <code><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html">pivot_wider()</a></code> function.</p>
<ul>
<li>
<code>id_cols</code>: the column(s) that uniquely identify each new row</li>
<li>
<code>names_from</code>: the column(s) that contain your new column headers, the variable you want to spread wider</li>
<li>
<code>values_from</code>: the column that contains the values for the new columns</li>
</ul>
<p>Again, it's easier to show than tell so run this code and then compare <code>polyps_tidy</code> with <code>polys_wide</code> (which should look like the original <code>polyps</code> dataset).</p>
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">polyps_wide</span> <span class="op">&lt;-</span> <span class="va">polyps_tidy</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html">pivot_wider</a></span><span class="op">(</span>
  id_cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"participant_id"</span>, <span class="st">"sex"</span>, <span class="st">"age"</span>, <span class="st">"treatment"</span><span class="op">)</span>, <span class="co"># identifying column(s)</span>
  names_from <span class="op">=</span> <span class="va">time</span>, <span class="co"># the new column names</span>
  values_from <span class="op">=</span> <span class="va">polyps_n</span> <span class="co"># the new column values</span>
<span class="op">)</span></code></pre></div>
<div class="inline-table"><table class="table table-sm">
<caption>
<span id="tab:pivot-wider">Table 3.1: </span>Data made wider with pivot_wider()
</caption>
<thead><tr>
<th style="text-align:left;">
participant_id
</th>
<th style="text-align:left;">
sex
</th>
<th style="text-align:right;">
age
</th>
<th style="text-align:left;">
treatment
</th>
<th style="text-align:right;">
baseline
</th>
<th style="text-align:right;">
number3m
</th>
<th style="text-align:right;">
number12m
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
001
</td>
<td style="text-align:left;">
female
</td>
<td style="text-align:right;">
17
</td>
<td style="text-align:left;">
sulindac
</td>
<td style="text-align:right;">
7
</td>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:left;">
002
</td>
<td style="text-align:left;">
female
</td>
<td style="text-align:right;">
20
</td>
<td style="text-align:left;">
placebo
</td>
<td style="text-align:right;">
77
</td>
<td style="text-align:right;">
67
</td>
<td style="text-align:right;">
63
</td>
</tr>
<tr>
<td style="text-align:left;">
003
</td>
<td style="text-align:left;">
male
</td>
<td style="text-align:right;">
16
</td>
<td style="text-align:left;">
sulindac
</td>
<td style="text-align:right;">
7
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
2
</td>
</tr>
<tr>
<td style="text-align:left;">
004
</td>
<td style="text-align:left;">
female
</td>
<td style="text-align:right;">
18
</td>
<td style="text-align:left;">
placebo
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
28
</td>
</tr>
<tr>
<td style="text-align:left;">
005
</td>
<td style="text-align:left;">
male
</td>
<td style="text-align:right;">
22
</td>
<td style="text-align:left;">
sulindac
</td>
<td style="text-align:right;">
23
</td>
<td style="text-align:right;">
16
</td>
<td style="text-align:right;">
17
</td>
</tr>
<tr>
<td style="text-align:left;">
006
</td>
<td style="text-align:left;">
female
</td>
<td style="text-align:right;">
13
</td>
<td style="text-align:left;">
placebo
</td>
<td style="text-align:right;">
35
</td>
<td style="text-align:right;">
31
</td>
<td style="text-align:right;">
61
</td>
</tr>
</tbody>
</table></div>
<p>An example of when wide-format data is required is if you needed to create a scatterplot or conduct a correlation between two levels of a grouping variable so and so you need the data in separate columns:</p>
<div class="sourceCode" id="cb52"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">polyps_wide</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">baseline</span> <span class="op">&lt;</span> <span class="fl">200</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="co"># remove the outliers</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">baseline</span>, y <span class="op">=</span> <span class="va">number12m</span>, colour <span class="op">=</span> <span class="va">treatment</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"lm"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="03-tidying_files/figure-html/unnamed-chunk-6-1.png" width="100%" style="display: block; margin: auto;"></div>
</div>
</div>
<div id="multistep" class="section level2" number="3.6">
<h2>
<span class="header-section-number">3.6</span> Multi-step tidying<a class="anchor" aria-label="anchor" href="#multistep"><i class="fas fa-link"></i></a>
</h2>
<p>Restructuring data between wide and long-form is arguably one of the most difficult tasks you will need to do whilst coding, because the nature of the problem depends not only on the design of your study but on the idiosyncrasies of the dataset organisation, and the interaction between the two. So, let's run through another example, this time with a slightly more complicated dataset that will require us to create intermediate objects.</p>
<p>For this example, we're going to use the <code>laryngoscope</code> dataset about intubation methods - I'd recommend reviewing the help documentation to familiarize yourself with the variables before you go any further (<code><a href="https://higgi13425.github.io/medicaldata/reference/laryngoscope.html">?laryngoscope</a></code>). This dataset is quite large so we're going to reduce the number of variables to just those we need for this example:</p>
<div class="sourceCode" id="cb53"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">laryn_subset</span> <span class="op">&lt;-</span> <span class="va">laryngoscope</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">age</span>, <span class="va">gender</span>, <span class="va">Randomization</span><span class="op">:</span><span class="va">attempt3_S_F</span><span class="op">)</span></code></pre></div>
<div id="adding-id-variables" class="section level3" number="3.6.1">
<h3>
<span class="header-section-number">3.6.1</span> Adding ID variables<a class="anchor" aria-label="anchor" href="#adding-id-variables"><i class="fas fa-link"></i></a>
</h3>
<p>This dataset doesn't originally have any participant ID codes. This is likely because it's in wide-form so we know which data points relate to which participant because they're all on the same row, however, when we start pulling apart and putting the data back together, it can prevent a number of issues to ensure you have a clear ID column for which observations all belong to the same thing.</p>
<p>To add on an ID number, we'll use <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code> to create a column where the ID number equals the row number. We'll also move it to be the first column of the dataset using <code><a href="https://dplyr.tidyverse.org/reference/select.html">select()</a></code> and <code><a href="https://tidyselect.r-lib.org/reference/everything.html">everything()</a></code> which then selects the <code>id</code> column, and then everything else in the dataset.</p>
<div class="sourceCode" id="cb54"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">laryn_subset</span> <span class="op">&lt;-</span> <span class="va">laryn_subset</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>id <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/ranking.html">row_number</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">id</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html">everything</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></code></pre></div>
</div>
<div id="untidy-long-form" class="section level3" number="3.6.2">
<h3>
<span class="header-section-number">3.6.2</span> Untidy long-form<a class="anchor" aria-label="anchor" href="#untidy-long-form"><i class="fas fa-link"></i></a>
</h3>
<p>Let's think about the variables we have in this dataset now. First, the uncomplicated ones:</p>
<ul>
<li>
<code>id</code>, <code>age</code>, <code>gender</code>, <code>Randomization</code>
</li>
</ul>
<p>We then have eight columns with different information about the intubation attempts. Whilst there are eight columns, there are really four different types of information, or variables:</p>
<ul>
<li>
<code>attempt</code> the attempt number of the intubation, 1-3</li>
<li>
<code>time</code> the intubation attempt time in seconds</li>
<li>
<code>success</code> whether the intubation attempt was successful</li>
<li>
<code>method</code> the method used for the intubation attempt</li>
</ul>
<p>Let's try the code we used to transform the previous, simpler dataset:</p>
<div class="sourceCode" id="cb55"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">laryn_tidy1</span> <span class="op">&lt;-</span> <span class="va">laryn_subset</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">starts_with</a></span><span class="op">(</span><span class="st">"attempt"</span><span class="op">)</span>, <span class="co">#tidy all variables that start with "attempt"</span>
               names_to <span class="op">=</span> <span class="st">"variable"</span>, 
               values_to <span class="op">=</span> <span class="st">"score"</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb56"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">laryn_tidy1</span><span class="op">)</span></code></pre></div>
<div class="kable-table">
<div class="inline-table"><table class="table table-sm">
<thead><tr>
<th style="text-align:right;">
id
</th>
<th style="text-align:right;">
age
</th>
<th style="text-align:right;">
gender
</th>
<th style="text-align:right;">
Randomization
</th>
<th style="text-align:left;">
variable
</th>
<th style="text-align:right;">
score
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
51
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:left;">
attempt1_time
</td>
<td style="text-align:right;">
29
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
51
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:left;">
attempt1_S_F
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
51
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:left;">
attempt2_time
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
51
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:left;">
attempt2_assigned_method
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
51
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:left;">
attempt2_S_F
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
51
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:left;">
attempt3_time
</td>
<td style="text-align:right;">
NA
</td>
</tr>
</tbody>
</table></div>
</div>
<p>This isn't right - we've got multiple different types of information in both the <code>variable</code> and <code>score</code> columns. First, let's separate out the attempt from the measurement. This is somewhat straightforward in that the information about which attempt it is is always to the left of the first underscore in the variable name (e.g., <code>attempt1_time</code>), so we can use the argument <code>names_sep</code> to tell R to split the column at the underscore and put the data from each side into two columns named <code>attempt</code> and <code>measurement</code>.</p>
<p>If you do have control over your data, this is a key reason why consistent naming conventions are super important. If you have consistent and meaningful uses of capital letters, underscores, and periods in your variable names, you can then use this information to manipulate your data frames far more easily. The <code>laryn</code> dataset has used underscores to separate the names bits of information (e.g., <code>attempt1_time</code>) but has also used them as generic spaces (e.g., <code>attempt2_assignment_method</code>).</p>
<p>What this means is that when we tidy the dataset with the <code>names_sep</code> argument, we'll get a warning message:</p>
<div class="sourceCode" id="cb57"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">laryn_tidy2</span> <span class="op">&lt;-</span> <span class="va">laryn_subset</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">attempt1_time</span><span class="op">:</span><span class="va">attempt3_S_F</span><span class="op">)</span>,
               names_sep <span class="op">=</span> <span class="st">"_"</span>,
               names_to <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"attempt"</span>, <span class="st">"measurement"</span><span class="op">)</span>, 
               values_to <span class="op">=</span> <span class="st">"score"</span><span class="op">)</span></code></pre></div>
<pre><code>## Warning: Expected 2 pieces. Additional pieces discarded in 5 rows [2, 4, 5, 7,
## 8].</code></pre>
<p>Because we have asked R to separate the variables by an underscore and have only given it two column names, it has discarded the information that comes after the second underscore. This doesn't actually make a great deal of difference to this dataset, the labeling is still relatively meaningful:</p>
<div class="kable-table">
<div class="inline-table"><table class="table table-sm">
<thead><tr>
<th style="text-align:right;">
id
</th>
<th style="text-align:right;">
age
</th>
<th style="text-align:right;">
gender
</th>
<th style="text-align:right;">
Randomization
</th>
<th style="text-align:left;">
attempt
</th>
<th style="text-align:left;">
measurement
</th>
<th style="text-align:right;">
score
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
51
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:left;">
attempt1
</td>
<td style="text-align:left;">
time
</td>
<td style="text-align:right;">
29
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
51
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:left;">
attempt1
</td>
<td style="text-align:left;">
S
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
51
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:left;">
attempt2
</td>
<td style="text-align:left;">
time
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
51
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:left;">
attempt2
</td>
<td style="text-align:left;">
assigned
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
51
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:left;">
attempt2
</td>
<td style="text-align:left;">
S
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
51
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:left;">
attempt3
</td>
<td style="text-align:left;">
time
</td>
<td style="text-align:right;">
NA
</td>
</tr>
</tbody>
</table></div>
</div>
<p>However, if you'd like more precise control over your separation, you can use the <code>names_pattern</code> argument. <code>(.*?)_(.*)</code> uses two groups of data where the first group is everything until the first underscore <code>((.*?))</code> in the column name and the second group is everything after the underscore following the first group <code>((.*))</code> (Thank you to <a href="https://stackoverflow.com/questions/64150083/using-pivot-longer-in-tidyr-with-a-complex-separator">Stack Overflow</a> for this solution!).</p>
<div class="sourceCode" id="cb59"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">laryn_tidy3</span> <span class="op">&lt;-</span> <span class="va">laryn_subset</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">attempt1_time</span><span class="op">:</span><span class="va">attempt3_S_F</span><span class="op">)</span>,
               names_pattern <span class="op">=</span> <span class="st">'(.*?)_(.*)'</span>,
               names_to <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"attempt"</span>, <span class="st">"measurement"</span><span class="op">)</span>, 
               values_to <span class="op">=</span> <span class="st">"score"</span><span class="op">)</span></code></pre></div>
<div class="kable-table">
<div class="inline-table"><table class="table table-sm">
<thead><tr>
<th style="text-align:right;">
id
</th>
<th style="text-align:right;">
age
</th>
<th style="text-align:right;">
gender
</th>
<th style="text-align:right;">
Randomization
</th>
<th style="text-align:left;">
attempt
</th>
<th style="text-align:left;">
measurement
</th>
<th style="text-align:right;">
score
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
51
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:left;">
attempt1
</td>
<td style="text-align:left;">
time
</td>
<td style="text-align:right;">
29
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
51
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:left;">
attempt1
</td>
<td style="text-align:left;">
S_F
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
51
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:left;">
attempt2
</td>
<td style="text-align:left;">
time
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
51
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:left;">
attempt2
</td>
<td style="text-align:left;">
assigned_method
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
51
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:left;">
attempt2
</td>
<td style="text-align:left;">
S_F
</td>
<td style="text-align:right;">
NA
</td>
</tr>
<tr>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
51
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:left;">
attempt3
</td>
<td style="text-align:left;">
time
</td>
<td style="text-align:right;">
NA
</td>
</tr>
</tbody>
</table></div>
</div>
</div>
<div id="spreading-variables-to-create-tidy-data" class="section level3" number="3.6.3">
<h3>
<span class="header-section-number">3.6.3</span> Spreading variables to create tidy data<a class="anchor" aria-label="anchor" href="#spreading-variables-to-create-tidy-data"><i class="fas fa-link"></i></a>
</h3>
<p>This still isn't quite right because whilst we have sorted out the names, the <code>score</code> variable contains three different types of measurement (the intubation time, whether it was a success or failure, and the assignment method). Instead we need an additional step where we spread these measurements across different variables:</p>
<div class="sourceCode" id="cb60"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">laryn_tidy4</span> <span class="op">&lt;-</span> <span class="va">laryn_tidy3</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html">pivot_wider</a></span><span class="op">(</span>id_cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"id"</span>, <span class="st">"age"</span>, <span class="st">"gender"</span>, <span class="st">"Randomization"</span>, <span class="st">"attempt"</span><span class="op">)</span>,
              names_from <span class="op">=</span> <span class="st">"measurement"</span>, 
              values_from <span class="op">=</span> <span class="st">"score"</span><span class="op">)</span></code></pre></div>
<div class="info">
<p>Technically, you can skip setting the <code>id_cols</code> argument, because all of the columns apart from the <code>names_from</code> column and the <code>values_from</code> column identify the observation (e.g., each observation is identified by the unique combination of <code>id</code>, <code>age</code>, <code>gender</code> etc). You only have to set the <code>id_cols</code> argument when this is not the case although it can be a useful exercise to help ensure you understand the structure of your data.</p>
</div>
</div>
<div id="correcting-factors" class="section level3" number="3.6.4">
<h3>
<span class="header-section-number">3.6.4</span> Correcting factors<a class="anchor" aria-label="anchor" href="#correcting-factors"><i class="fas fa-link"></i></a>
</h3>
<p>Finally, we can also tidy up some of the categorical variables: <code>gender</code>, <code>Randomization</code> and <code>S_F</code> are represented as numerical data but they're actually categories. We could just tell R that this data is a factor and leave the values as they are:</p>
<div class="sourceCode" id="cb61"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="va">laryn_tidy4</span><span class="op">)</span>

<span class="va">laryn_tidy5</span> <span class="op">&lt;-</span> <span class="va">laryn_tidy4</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>gender <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">gender</span><span class="op">)</span>,
         Randomization <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">Randomization</span><span class="op">)</span>,
         S_F <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">S_F</span><span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="va">laryn_tidy5</span><span class="op">)</span></code></pre></div>
<p>But we might as well take the opportunity to make our dataset more readable. The great thing about working in R is that you don't have to have everything coded numerically as you would in e.g., SPSS. Instead, we can use text labels which means we don't have to remember what 0 and 1 means.</p>
<div class="sourceCode" id="cb62"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">laryn_tidy6</span> <span class="op">&lt;-</span> <span class="va">laryn_tidy4</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>gender <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">gender</span>, 
                         levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span>,
                         labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"female"</span>, <span class="st">"male"</span><span class="op">)</span><span class="op">)</span>,
    Randomization <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">Randomization</span>, 
                                levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span>, 
                                labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Standard"</span>, <span class="st">"AWS"</span><span class="op">)</span><span class="op">)</span>,
         S_F <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">S_F</span>, 
                      levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span>, 
                      labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"failure"</span>, <span class="st">"success"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="va">laryn_tidy6</span><span class="op">)</span></code></pre></div>
<p>Now the data are finally in tidy format we can use our tidyverse functions to easily summarize and visualize by different variables.For example, we can calculate the average intubation time for each attempt:</p>
<div class="sourceCode" id="cb63"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">laryn_tidy6</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">attempt</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span>mean_time <span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">time</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="kable-table">
<div class="inline-table"><table class="table table-sm">
<thead><tr>
<th style="text-align:left;">
attempt
</th>
<th style="text-align:right;">
mean_time
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
attempt1
</td>
<td style="text-align:right;">
33.40909
</td>
</tr>
<tr>
<td style="text-align:left;">
attempt2
</td>
<td style="text-align:right;">
42.90000
</td>
</tr>
<tr>
<td style="text-align:left;">
attempt3
</td>
<td style="text-align:right;">
21.33333
</td>
</tr>
</tbody>
</table></div>
</div>
<p>Or we could visualize the numberof success and failures on each attempt:</p>
<div class="sourceCode" id="cb64"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">laryn_tidy6</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">S_F</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="co"># remove NAs from plot</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">S_F</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="op">~</span> <span class="va">attempt</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="03-tidying_files/figure-html/unnamed-chunk-21-1.png" width="100%" style="display: block; margin: auto;"></div>
</div>
</div>
<div id="pipes" class="section level2" number="3.7">
<h2>
<span class="header-section-number">3.7</span> Pipes<a class="anchor" aria-label="anchor" href="#pipes"><i class="fas fa-link"></i></a>
</h2>
<div style="width: 200px; float: right;">
<div class="inline-figure"><img src="images/tidy/pipe_sticker.png" style="width: 100%"></div>
</div>
<p>We've used pipes <code>%&gt;%</code> throughout this course but this type of data processing is where they really start to shine, as they can significantly reduce the amount of code you write.</p>
<p>As a recap, a pipe takes the result of the previous function and sends it to the next function as its first argument, which means that you do not need to create intermediate objects. Below is all the code we've used in this chapter, and in the process we created multiple objects. This can get very confusing in longer scripts.</p>
<div class="sourceCode" id="cb65"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># read in data</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"laryngoscope"</span><span class="op">)</span>

<span class="co"># select subset of data</span>
<span class="va">laryn_subset</span> <span class="op">&lt;-</span> <span class="va">laryngoscope</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">age</span>, <span class="va">gender</span>, <span class="va">Randomization</span><span class="op">:</span><span class="va">attempt3_S_F</span><span class="op">)</span>

<span class="co"># add ID column</span>
<span class="va">laryn_subset</span> <span class="op">&lt;-</span> <span class="va">laryn_subset</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>id <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/ranking.html">row_number</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">id</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html">everything</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>

<span class="co"># create untidy long-form data</span>
<span class="va">laryn_tidy3</span> <span class="op">&lt;-</span> <span class="va">laryn_subset</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">attempt1_time</span><span class="op">:</span><span class="va">attempt3_S_F</span><span class="op">)</span>,
               names_pattern <span class="op">=</span> <span class="st">'(.*?)_(.*)'</span>,
               names_to <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"attempt"</span>, <span class="st">"measurement"</span><span class="op">)</span>, 
               values_to <span class="op">=</span> <span class="st">"score"</span><span class="op">)</span>

<span class="co"># finalise tidy data by spreading variables</span>
<span class="va">laryn_tidy4</span> <span class="op">&lt;-</span> <span class="va">laryn_tidy3</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html">pivot_wider</a></span><span class="op">(</span>id_cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"id"</span>, <span class="st">"age"</span>, <span class="st">"gender"</span>, <span class="st">"Randomization"</span>, <span class="st">"attempt"</span><span class="op">)</span>,
              names_from <span class="op">=</span> <span class="st">"measurement"</span>, 
              values_from <span class="op">=</span> <span class="st">"score"</span><span class="op">)</span>


<span class="co"># correct factors</span>
<span class="va">laryn_tidy6</span> <span class="op">&lt;-</span> <span class="va">laryn_tidy4</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>gender <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">gender</span>, 
                         levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span>,
                         labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"female"</span>, <span class="st">"male"</span><span class="op">)</span><span class="op">)</span>,
    Randomization <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">Randomization</span>, 
                                levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span>, 
                                labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Standard"</span>, <span class="st">"AWS"</span><span class="op">)</span><span class="op">)</span>,
         S_F <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">S_F</span>, 
                      levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span>, 
                      labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"failure"</span>, <span class="st">"success"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="warning">
<p>You <em>can</em> give each object the same name and keep replacing the old data object with the new one at each step. This will keep your environment clean, but it makes debugging code much harder.</p>
</div>
<p>For longer series of steps like the one above, using pipes can eliminate many intermediate objects. This also makes it easier to add an intermediate step to your process without having to think of a new table name and edit the table input to the next step (which is really easy to accidentally miss).</p>
<div class="sourceCode" id="cb66"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"laryngoscope"</span><span class="op">)</span>

<span class="va">laryn_tidy</span> <span class="op">&lt;-</span>  <span class="va">laryngoscope</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">age</span>, <span class="va">gender</span>, <span class="va">Randomization</span><span class="op">:</span><span class="va">attempt3_S_F</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>id <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/ranking.html">row_number</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">id</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html">everything</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">attempt1_time</span><span class="op">:</span><span class="va">attempt3_S_F</span><span class="op">)</span>,
               names_pattern <span class="op">=</span> <span class="st">'(.*?)_(.*)'</span>,
               names_to <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"attempt"</span>, <span class="st">"measurement"</span><span class="op">)</span>, 
               values_to <span class="op">=</span> <span class="st">"score"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html">pivot_wider</a></span><span class="op">(</span>id_cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"id"</span>, <span class="st">"age"</span>, <span class="st">"gender"</span>, <span class="st">"Randomization"</span>, <span class="st">"attempt"</span><span class="op">)</span>,
              names_from <span class="op">=</span> <span class="st">"measurement"</span>, 
              values_from <span class="op">=</span> <span class="st">"score"</span><span class="op">)</span><span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>gender <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">gender</span>, 
                         levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span>,
                         labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"female"</span>, <span class="st">"male"</span><span class="op">)</span><span class="op">)</span>,
    Randomization <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">Randomization</span>, 
                                levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span>, 
                                labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Standard"</span>, <span class="st">"AWS"</span><span class="op">)</span><span class="op">)</span>,
         S_F <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">S_F</span>, 
                      levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span>, 
                      labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"failure"</span>, <span class="st">"success"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>You can read the code above like this:</p>
<ol style="list-style-type: decimal">
<li><p>Start with the dataset <code>laryngoscope</code> <strong>and then</strong></p></li>
<li><p>Select the columns we're interested in with <code><a href="https://dplyr.tidyverse.org/reference/select.html">select()</a></code> <strong>and then</strong></p></li>
<li><p>Add on an ID column with <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code> <strong>and then</strong></p></li>
<li><p>Move the ID column to the start of the dataset with <code><a href="https://dplyr.tidyverse.org/reference/select.html">select()</a></code> <strong>and then</strong></p></li>
<li><p>Reshape the data longer with <code><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer()</a></code> <strong>and then</strong></p></li>
<li><p>Reshape the data wider with <code><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html">pivot_wider()</a></code> <strong>and then</strong></p></li>
<li><p>Set categorical variables to factors using <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code> and <code><a href="https://rdrr.io/r/base/factor.html">factor()</a></code> and update the text labels.</p></li>
</ol>
<p>Don't feel like you always need to get all of your data wrangling code into a single pipeline. You should make intermediate objects whenever you need to break up your code because it's getting too complicated or if you need to debug something.</p>
<div class="info">
<p>You can debug a pipe by highlighting from the beginning to just before the pipe you want to stop at. Try this by highlighting from <code>laryn_tidy &lt;-</code> to the end of the <code>pivot_longer</code> function (just before the next pipe) and typing command-enter (mac) or control-enter (PC). What does <code>laryn_tidy</code> look like now?</p>
</div>
</div>
<div id="exercises" class="section level2" number="3.8">
<h2>
<span class="header-section-number">3.8</span> Exercises<a class="anchor" aria-label="anchor" href="#exercises"><i class="fas fa-link"></i></a>
</h2>
<p>As noted, reshaping data is one of the most difficult tasks to learn because every dataset is different. To help you practice, here are a few more examples that you can work through on your own.</p>
<ul>
<li>In the set-up code chunk, load the <code class="package">tidyverse</code> then load the two data files in using <code><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv()</a></code> and name the objects <code>wide1</code> and <code>wide2</code>
</li>
</ul>
<div class="sourceCode" id="cb67"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span>
<span class="va">wide1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv</a></span><span class="op">(</span><span class="st">"https://psyteachr.github.io/ads-v1/data/wide_exercise-1.csv"</span><span class="op">)</span>
<span class="va">wide2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv</a></span><span class="op">(</span><span class="st">"https://psyteachr.github.io/ads-v1/data/wide_exercise-2.csv"</span><span class="op">)</span></code></pre></div>
<p>The two datasets represent simulated data from a patient satisfaction survey. We'll do them one at a time, as they differ in complexity.</p>
<div id="survey-1" class="section level3" number="3.8.1">
<h3>
<span class="header-section-number">3.8.1</span> Survey 1<a class="anchor" aria-label="anchor" href="#survey-1"><i class="fas fa-link"></i></a>
</h3>
<p><code>wide1</code> has data from 50 patients who were asked five questions about their most recent experience at a health centre. The results from this questionnaire are typically reported as a single overall satisfaction score, which is calculated by taking the mean of the five responses. Additionally, the survey also records whether the patient was attending the clinic for the first time, or as a repeat patient.</p>
<ul>
<li>Use your method of choice to look at the dataset and familiarise yourself with its structure and data.</li>
</ul>
<div class="webex-solution">
<button>
Solution
</button>
<p>You can click on the object to view it in the viewing pane or you could use any of the following:</p>
<div class="sourceCode" id="cb68"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="va">wide1</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">wide1</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">wide1</span><span class="op">)</span></code></pre></div>
</div>
<p>As noted, it's important to think through what your tidied data should look like. Often, the problem with data wrangling in R isn't actually the code, it's a lack of understanding of the data that's being worked on.</p>
<ol style="list-style-type: decimal">
<li>How many <strong>variables</strong> should the long-form version of <code>wide</code> have? <input class="webex-solveme nospaces" size="1" data-answer='["4"]'>
</li>
<li>How many <strong>observations</strong> should the long-form version of <code>wide1</code> have? <input class="webex-solveme nospaces" size="3" data-answer='["250"]'>
</li>
</ol>
<div class="webex-solution">
<button>
Explain these answers
</button>
<ol style="list-style-type: decimal">
<li>There should be four variables, as there are 4 types of data: patient id, whether they are a repeat patient, the question they were asked, and their response.</li>
<li>There will be 250 observations or rows of data because each patient will have 5 rows of data (one per question) and there are 50 patients (50 * 5 = 250).</li>
</ol>
</div>
</div>
<div id="tidy-1" class="section level3" number="3.8.2">
<h3>
<span class="header-section-number">3.8.2</span> Tidy 1<a class="anchor" aria-label="anchor" href="#tidy-1"><i class="fas fa-link"></i></a>
</h3>
<p>Transform <code>wide1</code> to long-form using <code><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer()</a></code> and store it in an object named <code>tidy1</code></p>
<div class="webex-solution">
<button>
Solution
</button>
<div class="sourceCode" id="cb69"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">tidy1</span> <span class="op">&lt;-</span> <span class="va">wide1</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="va">q1</span><span class="op">:</span><span class="va">q5</span>,
               names_to <span class="op">=</span> <span class="st">"question"</span>, 
               values_to <span class="op">=</span> <span class="st">"response"</span><span class="op">)</span></code></pre></div>
</div>
</div>
<div id="survey-2" class="section level3" number="3.8.3">
<h3>
<span class="header-section-number">3.8.3</span> Survey 2<a class="anchor" aria-label="anchor" href="#survey-2"><i class="fas fa-link"></i></a>
</h3>
<p><code>wide2</code> also has data from 50 patients, however, there are now two measures included in the questionnaire. There are still five questions that relate to satisfaction, but there are also five questions that relate to whether the patient would recommend the medical practice to a friend. Both measures are typically reported by calculating an overall mean for each of the five items.</p>
<ul>
<li>Use your method of choice to look at the dataset and familiarize yourself with its structure and data.</li>
</ul>
<p>This is not as simple as the first exercise because there's actually two potential ways you might tidy this data, depending on what you want to do with it and how you conceptualize the two different measurements. It's important to recognize that many of your coding problems will not have just one solution.</p>
<div id="tidy-2a" class="section level4" number="3.8.3.1">
<h4>
<span class="header-section-number">3.8.3.1</span> Tidy 2a<a class="anchor" aria-label="anchor" href="#tidy-2a"><i class="fas fa-link"></i></a>
</h4>
<p>For the first option, we're going to treat the "satisfaction" and "recommendation" measurements as two categories of the same variable. This will be a fully long-form data set with five variables <code>id</code>, <code>repeat_patient</code>, <code>question</code> (the question number), <code>category</code> (whether it's <code>sat</code> or <code>rec</code>), and <code>response</code> (the numerical rating).</p>
<ul>
<li>How many <strong>observations</strong> should the fully long-form version of <code>wide2</code> have? <input class="webex-solveme nospaces" size="3" data-answer='["500"]'>
</li>
</ul>
<div class="webex-solution">
<button>
Explain this answer
</button>
<p>There will be 500 rows of data because each participant will have 10 rows: 5 for the satisfaction questions and five for the recommendation questions.</p>
</div>
<p>Transform <code>wide2</code> to full long-form using <code><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer()</a></code> and store it in an object named <code>tidy2a</code>.</p>
<div class="webex-solution">
<button>
Hint 1
</button>
<p><code>data %&gt;% pivot_longer()</code></p>
</div>
<div class="webex-solution">
<button>
Hint 2
</button>
<p><code>names_to  = c("col1", "col2")</code></p>
</div>
<div class="webex-solution">
<button>
Solution
</button>
<div class="sourceCode" id="cb70"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">tidy2a</span> <span class="op">&lt;-</span> <span class="va">wide2</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="va">q1_sat</span><span class="op">:</span><span class="va">q5_rec</span>,
               names_to <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"question"</span>, <span class="st">"category"</span><span class="op">)</span>, 
               names_sep <span class="op">=</span> <span class="st">"_"</span>,
               values_to <span class="op">=</span> <span class="st">"response"</span><span class="op">)</span></code></pre></div>
</div>
</div>
<div id="tidy-2b" class="section level4" number="3.8.3.2">
<h4>
<span class="header-section-number">3.8.3.2</span> Tidy 2b<a class="anchor" aria-label="anchor" href="#tidy-2b"><i class="fas fa-link"></i></a>
</h4>
<p>The second option is to treat the satisfaction and recommendation scores as two distinct variables. This only makes sense if the satisfaction and recommendation scores for each question number are related to each other (e.g., q1 is about the same thing for both questions), making them part of the same observation.</p>
<p>This version should also have five variables, but it won't be fully long-form, it'll be a slight mix of the two that we're going to call "semi-long". The variables in the semi-long version will be <code>id</code>, <code>repeat</code>, <code>question</code> (the question number), <code>sat</code> (the response for the satisfaction question), and <code>rec</code> (the response for the recommendation question).</p>
<ul>
<li>How many <strong>observations</strong> should the semi-long version of <code>wide2</code> have? <input class="webex-solveme nospaces" size="3" data-answer='["250"]'>
</li>
</ul>
<div class="webex-solution">
<button>
Explain this answer
</button>
<p>There will be 250 rows of data because, just like <code>tidy1</code>, each participant will have 5 rows, one for each of the five questions. The different responses to the satisfaction and recommendation questions are in different variables.</p>
</div>
<p>This will take multiple steps - you can create different objects or use a pipeline.</p>
<div class="webex-solution">
<button>
Hint 1
</button>
<p>You can reuse the code from <code>tidy2a</code>, you just need to add on an extra line that makes the data slightly wider.</p>
</div>
<div class="webex-solution">
<button>
Hint 2
</button>
<p><code>data %&gt;% pivot_longer() %&gt;% pivot_wider()</code></p>
</div>
<div class="webex-solution">
<button>
Solution
</button>
<div class="sourceCode" id="cb71"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">tidy2b</span> <span class="op">&lt;-</span> <span class="va">wide2</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="va">q1_sat</span><span class="op">:</span><span class="va">q5_rec</span>,
               names_to <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"question"</span>, <span class="st">"category"</span><span class="op">)</span>, 
               names_sep <span class="op">=</span> <span class="st">"_"</span>,
               values_to <span class="op">=</span> <span class="st">"response"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html">pivot_wider</a></span><span class="op">(</span>names_from <span class="op">=</span> <span class="st">"category"</span>, values_from <span class="op">=</span> <span class="st">"response"</span><span class="op">)</span></code></pre></div>
</div>
</div>
</div>
<div id="analysis-and-visualisation" class="section level3" number="3.8.4">
<h3>
<span class="header-section-number">3.8.4</span> Analysis and visualisation<a class="anchor" aria-label="anchor" href="#analysis-and-visualisation"><i class="fas fa-link"></i></a>
</h3>
<p>Using <code><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by()</a></code> and <code><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize()</a></code>, calculate the mean score for each participant for both satisfaction and recommendation. Do this for both versions of the dataset so that you can see how the structure of the dataset changes the approach you need to take.</p>
<div class="webex-solution">
<button>
Solution
</button>
<div class="sourceCode" id="cb72"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">tidy2a</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">id</span>, <span class="va">category</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span>mean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">response</span><span class="op">)</span><span class="op">)</span>

<span class="va">tidy2b</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">id</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span>mean_satisfaction <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">sat</span><span class="op">)</span>,
            mean_rec <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">rec</span><span class="op">)</span><span class="op">)</span></code></pre></div>
</div>
<p>Replicate the following:</p>
<div id="plot-1" class="section level4" number="3.8.4.1">
<h4>
<span class="header-section-number">3.8.4.1</span> Plot 1<a class="anchor" aria-label="anchor" href="#plot-1"><i class="fas fa-link"></i></a>
</h4>
<p>Scatterplot showing the relationship between satisfaction and recommendation scores, by whether the patient is a repeat patient.</p>
<div class="webex-solution">
<button>
Hint
</button>
<p><code><a href="https://ggplot2.tidyverse.org/reference/geom_jitter.html">geom_jitter()</a></code></p>
</div>
<div class="inline-figure"><img src="03-tidying_files/figure-html/unnamed-chunk-30-1.png" width="100%" style="display: block; margin: auto;"></div>
<div class="webex-solution">
<button>
Solution
</button>
<div class="sourceCode" id="cb73"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">tidy2b</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">sat</span>, y <span class="op">=</span> <span class="va">rec</span>, colour <span class="op">=</span> <span class="va">repeat_patient</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_jitter.html">geom_jitter</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"lm"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Satisfaction score"</span>, y <span class="op">=</span> <span class="st">"Recommendation score"</span>, title <span class="op">=</span> <span class="st">"Satisfaction and recommendation scores"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
</div>
</div>
<div id="plot-2" class="section level4" number="3.8.4.2">
<h4>
<span class="header-section-number">3.8.4.2</span> Plot 2<a class="anchor" aria-label="anchor" href="#plot-2"><i class="fas fa-link"></i></a>
</h4>
<p>Boxplots showing satisfaction and recommends scores for new and repeat patients separately.</p>
<div class="inline-figure"><img src="03-tidying_files/figure-html/unnamed-chunk-32-1.png" width="100%" style="display: block; margin: auto;"></div>
<div class="webex-solution">
<button>
Solution
</button>
<div class="sourceCode" id="cb74"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">tidy2a</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">repeat_patient</span>, y <span class="op">=</span> <span class="va">response</span>, fill <span class="op">=</span> <span class="va">repeat_patient</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_boxplot.html">geom_boxplot</a></span><span class="op">(</span>show.legend <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">category</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html">scale_fill_brewer</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"Dark2"</span><span class="op">)</span></code></pre></div>
</div>
</div>
<div id="plot-3" class="section level4" number="3.8.4.3">
<h4>
<span class="header-section-number">3.8.4.3</span> Plot 3<a class="anchor" aria-label="anchor" href="#plot-3"><i class="fas fa-link"></i></a>
</h4>
<p>Histogram showing the distribution of all responses, across questions and categories.</p>
<div class="inline-figure"><img src="03-tidying_files/figure-html/unnamed-chunk-34-1.png" width="100%" style="display: block; margin: auto;"></div>
<div class="webex-solution">
<button>
Solution
</button>
<div class="sourceCode" id="cb75"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">tidy2a</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">response</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram</a></span><span class="op">(</span>binwidth <span class="op">=</span> <span class="fl">1</span>, colour <span class="op">=</span> <span class="st">"black"</span>, fill <span class="op">=</span> <span class="st">"Grey"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Responses across all questions and categories"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
</div>
</div>
</div>
<div id="your-data" class="section level3" number="3.8.5">
<h3>
<span class="header-section-number">3.8.5</span> Your data<a class="anchor" aria-label="anchor" href="#your-data"><i class="fas fa-link"></i></a>
</h3>
<p>If you have a wide-form dataset of your own, try and tidy it into long-form and if you get stuck or you just want to check your solution, post it on the All of Us Research Academy Help and Discussion forum - just remember to be careful about sharing confidential data if it's your own dataset.</p>
<p>If your head hurts a bit at this point, rest assured it's absolutely normal. As we said at the start, reshaping and tidying data is a conceptual leap and there's no shortcut to the fact it just takes a bit of time and practice with different data sets - you will get there eventually!</p>
</div>
</div>
<div id="glossary-tidy" class="section level2" number="3.9">
<h2>
<span class="header-section-number">3.9</span> Glossary<a class="anchor" aria-label="anchor" href="#glossary-tidy"><i class="fas fa-link"></i></a>
</h2>
<div class="inline-table"><table class="table" style="margin-left: auto; margin-right: auto;">
<thead><tr>
<th style="text-align:left;">
term
</th>
<th style="text-align:left;">
definition
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
<a href="https://psyteachr.github.io/glossary/l.html#long" class="glossary" target="_blank">long</a>
</td>
<td style="text-align:left;">
A data format where each observation is on a separate row
</td>
</tr>
<tr>
<td style="text-align:left;">
<a href="https://psyteachr.github.io/glossary/o.html#observation" class="glossary" target="_blank">observation</a>
</td>
<td style="text-align:left;">
All of the data about a single trial or question.
</td>
</tr>
<tr>
<td style="text-align:left;">
<a href="https://psyteachr.github.io/glossary/t.html#tidy-data" class="glossary" target="_blank">tidy data</a>
</td>
<td style="text-align:left;">
A format for data that maps the meaning onto the structure.
</td>
</tr>
<tr>
<td style="text-align:left;">
<a href="https://psyteachr.github.io/glossary/v.html#value" class="glossary" target="_blank">value</a>
</td>
<td style="text-align:left;">
A single number or piece of data.
</td>
</tr>
<tr>
<td style="text-align:left;">
<a href="https://psyteachr.github.io/glossary/v.html#variable" class="glossary" target="_blank">variable</a>
</td>
<td style="text-align:left;">
(coding): A word that identifies and stores the value of some data for later use; (stats): An attribute or characteristic of an observation that you can measure, count, or describe
</td>
</tr>
<tr>
<td style="text-align:left;">
<a href="https://psyteachr.github.io/glossary/w.html#wide" class="glossary" target="_blank">wide</a>
</td>
<td style="text-align:left;">
A data format where all of the observations about one subject are in the same row
</td>
</tr>
</tbody>
</table></div>
</div>
<div id="resources-tidy" class="section level2" number="3.10">
<h2>
<span class="header-section-number">3.10</span> Further resources<a class="anchor" aria-label="anchor" href="#resources-tidy"><i class="fas fa-link"></i></a>
</h2>
<ul>
<li><a href="https://raw.githubusercontent.com/rstudio/cheatsheets/main/tidyr.pdf">Data tidying cheat sheet</a></li>
<li><a href="http://vita.had.co.nz/papers/tidy-data.html">Tidy Data</a></li>
<li>
<a href="http://r4ds.had.co.nz/tidy-data.html">Chapter 12: Tidy Data</a> in <em>R for Data Science</em>
</li>
<li>
<a href="http://r4ds.had.co.nz/pipes.html">Chapter 18: Pipes</a> in <em>R for Data Science</em>
</li>
</ul>
</div>
</div>

<script>

/* update total correct if #webex-total_correct exists */
update_total_correct = function() {
  console.log("webex: update total_correct");

  if (t = document.getElementById("webex-total_correct")) {
    var correct = document.getElementsByClassName("webex-correct").length;
    var solvemes = document.getElementsByClassName("webex-solveme").length;
    var radiogroups = document.getElementsByClassName("webex-radiogroup").length;
    var selects = document.getElementsByClassName("webex-select").length;

    t.innerHTML = correct + " of " + (solvemes + radiogroups + selects) + " correct";
  }
}

/* webex-solution button toggling function */
b_func = function() {
  console.log("webex: toggle hide");

  var cl = this.parentElement.classList;
  if (cl.contains('open')) {
    cl.remove("open");
  } else {
    cl.add("open");
  }
}

/* function for checking solveme answers */
solveme_func = function(e) {
  console.log("webex: check solveme");

  var real_answers = JSON.parse(this.dataset.answer);
  var my_answer = this.value;
  var cl = this.classList;
  if (cl.contains("ignorecase")) {
    my_answer = my_answer.toLowerCase();
  }
  if (cl.contains("nospaces")) {
    my_answer = my_answer.replace(/ /g, "")
  }

  if (my_answer == "") {
    cl.remove("webex-correct");
    cl.remove("webex-incorrect");
  } else if (real_answers.includes(my_answer)) {
    cl.add("webex-correct");
    cl.remove("webex-incorrect");
  } else {
    cl.add("webex-incorrect");
    cl.remove("webex-correct");
  }

  // match numeric answers within a specified tolerance
  if(this.dataset.tol > 0){
    var tol = JSON.parse(this.dataset.tol);
    var matches = real_answers.map(x => Math.abs(x - my_answer) < tol)
    if (matches.reduce((a, b) => a + b, 0) > 0) {
      cl.add("webex-correct");
    } else {
      cl.remove("webex-correct");
    }
  }

  // added regex bit
  if (cl.contains("regex")){
    answer_regex = RegExp(real_answers.join("|"))
    if (answer_regex.test(my_answer)) {
      cl.add("webex-correct");
    }
  }

  update_total_correct();
}

/* function for checking select answers */
select_func = function(e) {
  console.log("webex: check select");

  var cl = this.classList

  /* add style */
  cl.remove("webex-incorrect");
  cl.remove("webex-correct");
  if (this.value == "answer") {
    cl.add("webex-correct");
  } else if (this.value != "blank") {
    cl.add("webex-incorrect");
  }

  update_total_correct();
}

/* function for checking radiogroups answers */
radiogroups_func = function(e) {
  console.log("webex: check radiogroups");

  var checked_button = document.querySelector('input[name=' + this.id + ']:checked');
  var cl = checked_button.parentElement.classList;
  var labels = checked_button.parentElement.parentElement.children;

  /* get rid of styles */
  for (i = 0; i < labels.length; i++) {
    labels[i].classList.remove("webex-incorrect");
    labels[i].classList.remove("webex-correct");
  }

  /* add style */
  if (checked_button.value == "answer") {
    cl.add("webex-correct");
  } else {
    cl.add("webex-incorrect");
  }

  update_total_correct();
}

window.onload = function() {
  console.log("webex onload");
  /* set up solution buttons */
  var buttons = document.getElementsByTagName("button");

  for (var i = 0; i < buttons.length; i++) {
    if (buttons[i].parentElement.classList.contains('webex-solution')) {
      buttons[i].onclick = b_func;
    }
  }

  /* set up webex-solveme inputs */
  var solveme = document.getElementsByClassName("webex-solveme");

  for (var i = 0; i < solveme.length; i++) {
    /* make sure input boxes don't auto-anything */
    solveme[i].setAttribute("autocomplete","off");
    solveme[i].setAttribute("autocorrect", "off");
    solveme[i].setAttribute("autocapitalize", "off");
    solveme[i].setAttribute("spellcheck", "false");
    solveme[i].value = "";

    /* adjust answer for ignorecase or nospaces */
    var cl = solveme[i].classList;
    var real_answer = solveme[i].dataset.answer;
    if (cl.contains("ignorecase")) {
      real_answer = real_answer.toLowerCase();
    }
    if (cl.contains("nospaces")) {
      real_answer = real_answer.replace(/ /g, "");
    }
    solveme[i].dataset.answer = real_answer;

    /* attach checking function */
    solveme[i].onkeyup = solveme_func;
    solveme[i].onchange = solveme_func;

    $(solveme[i]).after(" <span class='webex-icon'></span>");
  }

  /* set up radiogroups */
  var radiogroups = document.getElementsByClassName("webex-radiogroup");
  for (var i = 0; i < radiogroups.length; i++) {
    radiogroups[i].onchange = radiogroups_func;
  }

  /* set up selects */
  var selects = document.getElementsByClassName("webex-select");
  for (var i = 0; i < selects.length; i++) {
    selects[i].onchange = select_func;
    $(selects[i]).after(" <span class='webex-icon'></span>");
  }

  update_total_correct();
}

</script><script>
$( document ).ready(function() {
  var cite = ' ';
  var psyteachr = ' <a href="https://psyteachr.github.io/"><img src="images/logos/psyteachr_logo.png" style="height: 31px; color: white;" alt="psyTeachR: Reproducible Research" /></a>';
  var license = ' <a rel="license" href="https://creativecommons.org/licenses/by-sa/4.0/" target="blank"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-sa/4.0/88x31.png"></a>';

  $("footer div.row div:eq(1) p").html(
    psyteachr + license + cite
  );

  // open rdrr links externally
  $("a[href^='https://rdrr.io']").click(function(){
    window.open(this.href);
    return false;
  });

  // visible second sidebar in mobile
  function move_sidebar() {
    var w = window.innerWidth;
    if (w < 992) {
      $("#toc").appendTo($("#main-nav"));
    } else {
      $("#toc").appendTo($("div.sidebar-chapter"));
    }
  }
  move_sidebar();
  window.onresize = move_sidebar;
});
</script><div class="chapter-nav">
<div class="prev"><a href="wrangle.html"><span class="header-section-number">2</span> Data Wrangling</a></div>
<div class="next"><a href="live-office-hour-1.html"><span class="header-section-number">4</span> Live Office Hour 1</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#tidy"><span class="header-section-number">3</span> Data Tidying</a></li>
<li><a class="nav-link" href="#ilo-tidy"><span class="header-section-number">3.1</span> Intended Learning Outcomes</a></li>
<li><a class="nav-link" href="#walkthrough-tidy"><span class="header-section-number">3.2</span> Walkthrough video</a></li>
<li><a class="nav-link" href="#setup-tidy"><span class="header-section-number">3.3</span> Set-up</a></li>
<li><a class="nav-link" href="#data-structures"><span class="header-section-number">3.4</span> Data Structures</a></li>
<li>
<a class="nav-link" href="#reshaping-data"><span class="header-section-number">3.5</span> Reshaping Data</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#wide-format-data"><span class="header-section-number">3.5.1</span> Wide-format data</a></li>
<li><a class="nav-link" href="#tidy-data"><span class="header-section-number">3.5.2</span> Tidy data</a></li>
<li><a class="nav-link" href="#wide-to-long"><span class="header-section-number">3.5.3</span> Wide to long</a></li>
<li><a class="nav-link" href="#long-to-wide"><span class="header-section-number">3.5.4</span> Long to wide</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#multistep"><span class="header-section-number">3.6</span> Multi-step tidying</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#adding-id-variables"><span class="header-section-number">3.6.1</span> Adding ID variables</a></li>
<li><a class="nav-link" href="#untidy-long-form"><span class="header-section-number">3.6.2</span> Untidy long-form</a></li>
<li><a class="nav-link" href="#spreading-variables-to-create-tidy-data"><span class="header-section-number">3.6.3</span> Spreading variables to create tidy data</a></li>
<li><a class="nav-link" href="#correcting-factors"><span class="header-section-number">3.6.4</span> Correcting factors</a></li>
</ul>
</li>
<li><a class="nav-link" href="#pipes"><span class="header-section-number">3.7</span> Pipes</a></li>
<li>
<a class="nav-link" href="#exercises"><span class="header-section-number">3.8</span> Exercises</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#survey-1"><span class="header-section-number">3.8.1</span> Survey 1</a></li>
<li><a class="nav-link" href="#tidy-1"><span class="header-section-number">3.8.2</span> Tidy 1</a></li>
<li><a class="nav-link" href="#survey-2"><span class="header-section-number">3.8.3</span> Survey 2</a></li>
<li><a class="nav-link" href="#analysis-and-visualisation"><span class="header-section-number">3.8.4</span> Analysis and visualisation</a></li>
<li><a class="nav-link" href="#your-data"><span class="header-section-number">3.8.5</span> Your data</a></li>
</ul>
</li>
<li><a class="nav-link" href="#glossary-tidy"><span class="header-section-number">3.9</span> Glossary</a></li>
<li><a class="nav-link" href="#resources-tidy"><span class="header-section-number">3.10</span> Further resources</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/psyteachr/template/blob/master/book/03-tidying.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/psyteachr/template/edit/master/book/03-tidying.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Intro to Data Wrangling and Analysis Using R</strong>" was written by Emily Nordmann &amp; Javan Carter. It was last built on 2023-02-11.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer>
</body>
</html>
